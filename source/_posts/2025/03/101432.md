---
title: Redis内存管理机制
tags:
  - redis
top: true
date: 2025-03-12
categories: Linux
---
Redis的**所有数据库共享同一内存空间**，并非按库平均分配内存。

<!-- more -->

### 一、Redis内存管理机制
1. **统一内存池**  
   Redis的所有数据库（默认16个，编号db0-db15）**共享同一个内存池**。数据按键值对存储，无论属于哪个库，均占用同一内存空间。例如，db0中存储的键`user:1`和db1中的`order:1`会共同竞争内存资源。
2. **内存分配策略**  
   - 内存分配基于全局配置参数（如`maxmemory`），当总内存达到上限时，触发淘汰策略（LRU、LFU等），不区分库；  
   - 内存优化手段（如SDS动态调整、整型存储）对所有库生效。

---

### 二、关键特性与影响
1. **无隔离性风险**  
   若某个库数据量激增，可能挤占其他库的内存，导致数据被淘汰。例如：  
   - 若db0写入大量数据，可能触发全局内存淘汰机制，删除db1中的键。
2. **内存统计维度**  
   Redis的`INFO memory`命令返回的是**实例级内存使用情况**，而非按库统计。需通过`MEMORY STATS`或`MEMORY USAGE key`分析具体键的占用。

---

### 三、优化建议
1. **分实例隔离**  
   若需严格隔离不同业务的数据内存，应部署多个Redis实例，而非依赖多库。
2. **精细化淘汰策略**  
   配置`maxmemory-policy`为`allkeys-lru`或`volatile-ttl`，平衡不同库的数据保留优先级。

---

### 四、与SDS内存优化的关联
Redis通过**SDS（简单动态字符串）**优化字符串存储，例如：  
- 预分配和惰性释放策略减少内存重分配次数；  
- 根据字符串长度动态选择结构体（如sdshdr8、sdshdr16）。  
这些优化对所有库生效，进一步提升共享内存的利用率。

---

如需验证内存分配，可通过以下命令：  
```bash
# 查看全局内存使用
INFO memory
# 统计所有键的内存占用（按库需自行遍历）
MEMORY STATS
```